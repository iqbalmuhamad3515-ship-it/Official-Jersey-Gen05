<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pre-Order Jersey GEN05</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a;
            color: #e5e5e5;
            scroll-behavior: smooth;
        }
        .gold-text { color: #d4af37; }
        .bg-gold { background-color: #d4af37; }
        .border-gold { border-color: #d4af37; }
        .hero-bg {
            background: linear-gradient(rgba(0,0,0,0.75), rgba(0,0,0,0.95)), url('https://github.com/iqbalmuhamad3515-ship-it/Official-Jersey-Gen05/blob/main/Gen05%20Background%20WEB.png?raw=true');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .hover-scale {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .hover-scale:hover {
            transform: translateY(-8px);
            border-color: rgba(212, 175, 55, 0.5);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }
        #notification {
            display: none;
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 3000;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        #sizeChartModal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 2000;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Notification Toast -->
    <div id="notification" class="glass p-5 rounded-2xl border-gold/50 border flex items-center gap-4 shadow-2xl max-w-sm">
        <div id="notif-icon" class="w-10 h-10 rounded-full flex items-center justify-center bg-gold text-black">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
        </div>
        <div>
            <h4 id="notif-title" class="font-bold text-white uppercase text-xs tracking-widest">Berhasil</h4>
            <p id="notif-message" class="text-sm text-gray-400">Pesanan telah tercatat.</p>
        </div>
    </div>

    <!-- Size Chart Modal -->
    <div id="sizeChartModal" onclick="this.style.display='none'">
        <div class="glass p-8 rounded-[2rem] max-w-2xl w-full border-gold/30 border space-y-6 max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center">
                <h3 class="text-2xl font-black uppercase tracking-tighter gold-text">Panduan Ukuran</h3>
                <button onclick="document.getElementById('sizeChartModal').style.display='none'" class="text-gray-400 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div class="w-full bg-white/5 rounded-2xl overflow-hidden border border-white/10 text-center p-4">
                <img src="https://github.com/iqbalmuhamad3515-ship-it/Official-Jersey-Gen05/blob/main/Adult%20Size%20Chart.png?raw=true" alt="Panduan Ukuran" class="mx-auto w-full h-auto object-contain max-h-[400px]" onerror="this.src='https://placehold.co/600x400/000000/d4af37?text=Gambar+Panduan+Ukuran'">
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-center text-sm">
                    <thead>
                        <tr class="border-b border-white/10 bg-white/5">
                            <th class="p-4 gold-text uppercase">Size</th>
                            <th class="p-4 gold-text uppercase">Lebar (cm)</th>
                            <th class="p-4 gold-text uppercase">Panjang (cm)</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-white/5">
                        <tr><td class="p-3 font-bold">S</td><td class="p-3">48</td><td class="p-3">68</td></tr>
                        <tr><td class="p-3 font-bold">M</td><td class="p-3">50</td><td class="p-3">70</td></tr>
                        <tr><td class="p-3 font-bold">L</td><td class="p-3">52</td><td class="p-3">72</td></tr>
                        <tr><td class="p-3 font-bold">XL</td><td class="p-3">54</td><td class="p-3">74</td></tr>
                        <tr><td class="p-3 font-bold">2XL</td><td class="p-3">56</td><td class="p-3">76</td></tr>
                        <tr><td class="p-3 font-bold text-gold">Custom</td><td class="p-3" colspan="2">Hubungi Admin</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <header class="relative min-h-screen flex flex-col items-center justify-center text-center px-4 hero-bg border-b border-gold/10">
        <div class="mb-8 animate-fade-in">
            <img src="https://github.com/iqbalmuhamad3515-ship-it/Official-Jersey-Gen05/blob/main/Gen05%20SOLID.png?raw=true" alt="Logo GEN05" class="w-48 h-48 md:w-64 md:h-64 object-contain drop-shadow-[0_0_40px_rgba(212,175,55,0.4)] mx-auto">
        </div>
        <div class="space-y-4 max-w-4xl animate-fade-in" style="animation-delay: 0.2s;">
            <h1 class="text-6xl md:text-9xl font-black uppercase tracking-tighter leading-none">
                Pre-Order <br><span class="gold-text">Jersey GEN05</span>
            </h1>
            <p class="text-xl md:text-3xl text-gray-300 font-light tracking-[0.2em] mt-4 uppercase">"Solid Tanpa Batas"</p>
        </div>
        
        <div class="mt-16 flex flex-wrap justify-center gap-6 animate-fade-in" style="animation-delay: 0.4s;">
            <a href="#view-jersey" class="bg-white/10 backdrop-blur-md border border-white/20 text-white hover:bg-white/20 font-bold py-4 px-12 rounded-full transition duration-300 uppercase tracking-widest text-sm">
                Lihat Jersey
            </a>
            <a href="#order-form" class="bg-gold hover:bg-yellow-500 text-black font-black py-4 px-12 rounded-full transition duration-300 shadow-[0_10px_30px_rgba(212,175,55,0.3)] uppercase tracking-widest text-sm">
                Pesan Sekarang
            </a>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-24 space-y-40">
        
        <!-- View Jersey Section -->
        <section id="view-jersey" class="space-y-16">
            <div class="text-center space-y-4">
                <h2 class="text-4xl md:text-6xl font-black uppercase tracking-tighter italic">Edisi <span class="gold-text">Koleksi 2026</span></h2>
                <div class="h-1 w-24 bg-gold mx-auto"></div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <div class="jersey-card glass rounded-[2.5rem] overflow-hidden group hover-scale">
                    <div class="relative aspect-square overflow-hidden bg-white/5">
                        <img src="https://github.com/iqbalmuhamad3515-ship-it/Official-Jersey-Gen05/blob/main/Jersey%20Match%20Gen05%202026.png?raw=true" alt="Match Jersey" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-60"></div>
                        <div class="absolute bottom-8 left-8">
                            <h3 class="text-3xl font-black uppercase text-white tracking-tighter">Match Jersey</h3>
                            <p class="text-xl font-bold gold-text tracking-widest mt-1">Rp 235.000</p>
                        </div>
                    </div>
                </div>

                <div class="jersey-card glass rounded-[2.5rem] overflow-hidden group hover-scale">
                    <div class="relative aspect-square overflow-hidden bg-white/5 flex items-center justify-center">
                        <img src="https://github.com/iqbalmuhamad3515-ship-it/Official-Jersey-Gen05/blob/main/Jersey%20Class%202%20Gen05%202026.png?raw=true" alt="Class Jersey" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-60"></div>
                        <div class="absolute bottom-8 left-8">
                            <h3 class="text-3xl font-black uppercase text-white tracking-tighter">Class Jersey</h3>
                            <p class="text-xl font-bold gold-text tracking-widest mt-1">Rp 210.000</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Order Form -->
        <section id="order-form" class="grid lg:grid-cols-12 gap-16 items-start">
            <div class="lg:col-span-5 space-y-10">
                <h2 class="text-4xl md:text-5xl font-black mb-6 uppercase tracking-tighter">Formulir <span class="gold-text">Pemesanan</span></h2>
                <div class="p-10 bg-gradient-to-br from-yellow-900/40 via-black to-black border border-gold/20 rounded-[2rem]">
                    <h4 class="font-black text-xl gold-text mb-8 uppercase tracking-widest border-b border-gold/10 pb-4">Info Rekening</h4>
                    <p class="text-white text-sm opacity-60 uppercase tracking-widest">Bank BTN</p>
                    <p class="text-3xl font-mono font-black text-white tracking-tighter my-2">3190-1700-0037-21</p>
                    <p class="text-gray-300 font-bold uppercase tracking-widest">Muhamad Iqbal</p>
                </div>
            </div>

            <div class="lg:col-span-7">
                <form id="preOrderForm" class="glass p-10 rounded-[2.5rem] space-y-8 shadow-2xl relative">
                    <div class="space-y-6">
                        <input type="text" id="name" name="name" required class="w-full bg-white/5 border border-white/10 rounded-2xl p-5 focus:border-gold outline-none transition-colors" placeholder="Nama Lengkap">
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="relative">
                                <select id="jerseyOrder" name="jersey" required class="w-full bg-white/5 border border-white/10 rounded-2xl p-5 focus:border-gold outline-none appearance-none cursor-pointer">
                                    <option value="" class="bg-black">Kategori Jersey...</option>
                                    <option value="Match Jersey" class="bg-black text-white">Match Jersey</option>
                                    <option value="Class Jersey" class="bg-black text-white">Class Jersey</option>
                                    <option value="Match and Class Jersey" class="bg-black text-white">Match & Class Jersey</option>
                                </select>
                                <div class="absolute right-5 top-1/2 -translate-y-1/2 pointer-events-none text-gold">▼</div>
                            </div>

                            <div class="relative">
                                <select id="jerseyType" name="type" required class="w-full bg-white/5 border border-white/10 rounded-2xl p-5 focus:border-gold outline-none appearance-none cursor-pointer">
                                    <option value="" class="bg-black">Pilih Lengan...</option>
                                    <option value="Short Sleeves" class="bg-black text-white">Short Sleeves (Pendek)</option>
                                    <option value="Long Sleeves" class="bg-black text-white">Long Sleeves (Panjang)</option>
                                </select>
                                <div class="absolute right-5 top-1/2 -translate-y-1/2 pointer-events-none text-gold">▼</div>
                            </div>
                        </div>

                        <!-- SIZE SELECTION -->
                        <div class="space-y-4">
                            <div class="flex justify-between items-end px-2">
                                <label class="text-xs uppercase font-black gold-text tracking-widest">Pilih Ukuran</label>
                                <button type="button" onclick="document.getElementById('sizeChartModal').style.display='flex'" class="text-[10px] uppercase font-bold text-gray-400 border-b border-gray-600 hover:text-gold hover:border-gold transition-all">
                                    Lihat Size Chart
                                </button>
                            </div>
                            <div id="sizeContainer" class="grid grid-cols-4 md:grid-cols-5 gap-3 min-h-[120px]">
                                <!-- Ukuran akan dirender di sini secara otomatis -->
                            </div>
                        </div>
                    </div>

                    <button type="submit" id="submitBtn" class="w-full bg-gold hover:bg-yellow-500 text-black font-black py-6 rounded-2xl transition-all shadow-xl uppercase tracking-widest disabled:opacity-50 disabled:cursor-not-allowed">
                        Kirim Pesanan
                    </button>
                </form>
            </div>
        </section>

        <!-- Table Recap -->
        <section id="rekap-data" class="space-y-10 pb-20">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <h2 class="text-4xl font-black uppercase tracking-tighter italic">Live <span class="gold-text">Rekapitulasi</span></h2>
                <div class="flex gap-4">
                    <span id="live-indicator" class="flex items-center gap-2 text-[10px] font-black tracking-widest text-red-500 animate-pulse">
                        <span class="w-2 h-2 rounded-full bg-red-500"></span> LIVE SYNCING
                    </span>
                </div>
            </div>
            
            <div class="overflow-hidden glass rounded-[2.5rem] border border-white/5">
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-white/5 border-b border-white/10">
                            <tr>
                                <th class="p-8 gold-text uppercase text-[10px] font-black tracking-widest">Pemesan</th>
                                <th class="p-8 gold-text uppercase text-[10px] font-black tracking-widest">Item</th>
                                <th class="p-8 gold-text uppercase text-[10px] font-black tracking-widest text-center">Tipe</th>
                                <th class="p-8 gold-text uppercase text-[10px] font-black tracking-widest text-center">Size</th>
                                <th class="p-8 gold-text uppercase text-[10px] font-black tracking-widest text-right">Status</th>
                            </tr>
                        </thead>
                        <tbody id="recapTableBody" class="divide-y divide-white/5 font-medium">
                            <tr><td colspan="5" class="p-12 text-center text-gray-500 italic">Mencari data pesanan terbaru...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <footer class="py-24 text-center border-t border-white/5 bg-black/90 text-gray-400">
        <p class="text-sm uppercase tracking-widest">&copy; 2026 GEN05 Official Jersey. Supported by Bara Tactic Board</p>
    </footer>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global config provided by environment
        let firebaseConfig, app, auth, db, appId;
        
        try {
            firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
            appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            
            if (firebaseConfig.apiKey) {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
            }
        } catch (e) {
            console.warn("Konfigurasi Firebase tidak lengkap.");
        }

        const scriptURL = "https://script.google.com/macros/s/AKfycbxCTpnKP22fWYZ8ttptzhL3oOA5_azaFsZDHlnMqw77QwMfjuHHVKXCZXwYD3s8yP2Eaw/exec"; 

        const sizes = ['S', 'M', 'L', 'XL', '2XL', '3XL', '4XL', '5XL', '6XL', '7XL'];
        const renderSizes = () => {
            const container = document.getElementById('sizeContainer');
            if (container) {
                container.innerHTML = sizes.map(size => `
                    <label class="relative group cursor-pointer block">
                        <input type="radio" name="size" value="${size}" class="peer hidden" required>
                        <div class="text-center py-4 border border-white/10 rounded-2xl peer-checked:bg-gold peer-checked:text-black font-black text-[12px] transition-all hover:bg-white/10 uppercase tracking-tighter">
                            ${size}
                        </div>
                    </label>
                `).join('');
            }
        };

        function showNotification(title, message, isError = false) {
            const notif = document.getElementById('notification');
            if (!notif) return;
            document.getElementById('notif-title').innerText = title;
            document.getElementById('notif-message').innerText = message;
            document.getElementById('notif-icon').className = `w-10 h-10 rounded-full flex items-center justify-center text-black ${isError ? 'bg-red-500' : 'bg-gold'}`;
            notif.style.display = 'flex';
            setTimeout(() => { notif.style.display = 'none'; }, 5000);
        }

        async function initApp() {
            if (!auth || !db) return;
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (err) {
                console.error("Auth Error:", err);
            }

            onAuthStateChanged(auth, (user) => {
                if (user) setupRealtimeListener();
            });
        }

        function setupRealtimeListener() {
            const tableBody = document.getElementById('recapTableBody');
            const indicator = document.getElementById('live-indicator');
            if (!tableBody || !db) return;

            const ordersCol = collection(db, 'artifacts', appId, 'public', 'data', 'orders');
            onSnapshot(ordersCol, (snapshot) => {
                const docs = snapshot.docs.map(doc => doc.data());
                docs.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));

                let html = '';
                if (docs.length === 0) {
                    html = '<tr><td colspan="5" class="p-12 text-center text-gray-500 italic">Belum ada pesanan yang tercatat.</td></tr>';
                } else {
                    docs.slice(0, 15).forEach(data => {
                        html += `
                            <tr class="hover:bg-white/[0.02] border-b border-white/5 transition-colors animate-fade-in">
                                <td class="p-8 font-black text-white uppercase tracking-tight">${data.name || '-'}</td>
                                <td class="p-8 text-gray-400 text-xs">${data.jersey || '-'}</td>
                                <td class="p-8 text-center text-gray-400 text-xs">${data.type || '-'}</td>
                                <td class="p-8 text-center"><span class="bg-gold text-black px-3 py-1 rounded font-black text-[10px]">${data.size || '-'}</span></td>
                                <td class="p-8 text-right"><span class="text-[10px] gold-text font-black uppercase tracking-widest">${data.status || 'PROSES'}</span></td>
                            </tr>`;
                    });
                }
                tableBody.innerHTML = html;
                if (indicator) {
                    indicator.innerHTML = '<span class="w-2 h-2 rounded-full bg-green-500"></span> SYNCED';
                    indicator.className = "flex items-center gap-2 text-[10px] font-black tracking-widest text-green-500";
                }
            }, (error) => {
                tableBody.innerHTML = '<tr><td colspan="5" class="p-12 text-center text-red-500/50 text-xs">Gagal memuat data real-time.</td></tr>';
            });
        }

        const form = document.getElementById('preOrderForm');
        form?.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const btn = document.getElementById('submitBtn');
            const user = auth?.currentUser;
            
            // Logika baru: Jika Firebase belum siap (user null), tetap izinkan ke Google Sheets
            // Hanya cegah jika keduannya (Firebase & Sheets) tidak ada
            if (!user && (!scriptURL || scriptURL.includes('AKfycbx...'))) {
                showNotification("Sistem Sibuk", "Sedang mengautentikasi, mohon tunggu sebentar.", true);
                return;
            }

            btn.disabled = true;
            btn.innerText = "MENGIRIM...";

            const name = document.getElementById('name').value;
            const jersey = document.getElementById('jerseyOrder').value;
            const type = document.getElementById('jerseyType').value;
            const size = form.querySelector('input[name="size"]:checked')?.value;

            if (!size) {
                showNotification("Pilih Ukuran", "Harap pilih ukuran jersey terlebih dahulu.", true);
                btn.disabled = false;
                btn.innerText = "KIRIM PESANAN";
                return;
            }

            try {
                // 1. Simpan ke Firestore (Jika login berhasil)
                if (user && db) {
                    const payloadFirestore = {
                        name, jersey, type, size,
                        status: 'PROSES',
                        createdAt: serverTimestamp(),
                        userId: user.uid
                    };
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), payloadFirestore);
                }

                // 2. Sinkronisasi ke Google Sheets (Selalu lakukan sebagai backup)
                if (scriptURL && !scriptURL.includes('AKfycbx...')) {
                    const formData = new FormData();
                    formData.append('action', 'write');
                    formData.append('name', name);
                    formData.append('jersey', jersey);
                    formData.append('type', type);
                    formData.append('size', size);

                    // Mode no-cors digunakan untuk melewati blokir browser pada Google Apps Script
                    fetch(scriptURL, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: formData
                    }).catch(err => console.warn("Silent error syncing to sheets:", err));
                }

                showNotification("Berhasil", "Pesanan Anda telah diterima!");
                form.reset();
                renderSizes();
            } catch (err) {
                console.error("Submit Error:", err);
                showNotification("Terjadi Kendala", "Gagal menyimpan otomatis. Mohon hubungi Admin.", true);
            } finally {
                btn.disabled = false;
                btn.innerText = "KIRIM PESANAN";
            }
        });

        // Jalankan render ukuran segera tanpa menunggu Firebase
        renderSizes();
        initApp();

        document.addEventListener('DOMContentLoaded', renderSizes);
    </script>
</body>
</html>
